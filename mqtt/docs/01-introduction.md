# MQTTとは - IoTの基盤となるメッセージングプロトコル

## 1.1 MQTTの概要

MQTT（Message Queuing Telemetry Transport）は、軽量で効率的なメッセージングプロトコルで、IoT（Internet of Things）アプリケーションのデファクトスタンダードとなっています。1999年にIBMのAndy Stanford-ClarkとCirrus LinkのArlen Nipperによって開発され、2019年にOASIS標準となりました。

### 設計思想

MQTTは以下の制約がある環境での使用を想定して設計されました：

- **帯域幅の制限**: モバイルネットワークや衛星通信
- **リソースの制約**: 低消費電力のセンサーやマイクロコントローラー
- **ネットワークの不安定性**: 断続的な接続や高遅延

## 1.2 なぜMQTTが重要なのか

### IoTにおける課題

現代のIoTシステムでは、以下のような課題があります：

1. **スケーラビリティ**: 数百万のデバイスが同時に接続
2. **リアルタイム性**: 低遅延でのデータ伝送
3. **エネルギー効率**: バッテリー駆動デバイスでの長寿命化
4. **信頼性**: 重要なデータの確実な配信

### MQTTが解決する問題

#### 軽量性
```
HTTP Request:
POST /api/temperature HTTP/1.1
Host: iot.example.com
Content-Type: application/json
Content-Length: 25

{"temperature": 23.5}

合計: ~150バイト

MQTT Publish:
PUBLISH temp/sensor1 23.5

合計: ~20バイト
```

#### 非同期通信
- プッシュベースでリアルタイムなデータ配信
- デバイス間の疎結合な通信

#### 接続維持
- 持続的なTCP接続によるオーバーヘッドの削減
- Keep-Aliveメカニズムによる接続状態の管理

## 1.3 MQTTの利用分野

### 1. 産業IoT（Industry 4.0）
- **製造業**: 製造ラインの監視、品質管理
- **エネルギー**: スマートグリッド、再生可能エネルギー管理
- **物流**: 資産追跡、フリート管理

### 2. スマートホーム・ビル
- **ホームオートメーション**: 照明制御、空調管理
- **セキュリティ**: 監視システム、アクセス制御
- **エネルギー管理**: 電力消費の最適化

### 3. ヘルスケア
- **リモート監視**: バイタルサイン、血糖値
- **医療機器**: インスリンポンプ、人工心臓ペースメーカー
- **緊急通知**: 転倒検知、緊急アラート

### 4. 農業（アグリテック）
- **環境監視**: 土壌湿度、気温、pH値
- **自動化**: 自動灌漑、肥料散布
- **ライブストック**: 家畜の健康管理、位置追跡

## 1.4 MQTTの市場動向（2025年）

### 統計データ
- **デバイス数**: 2025年までに750億台のIoTデバイスが接続予定
- **市場規模**: MQTTブローカー市場は年平均成長率15%で拡大
- **採用率**: Fortune 500企業の60%以上がMQTTを採用

### 新しいトレンド

#### MQTT over QUIC
従来のTCP/TLSに加えて、QUIC（Quick UDP Internet Connections）上でのMQTTが注目されています：

```
従来: MQTT → TCP → IP
新方式: MQTT → QUIC → UDP → IP
```

**利点:**
- 接続確立の高速化
- ネットワーク切り替え時の接続維持
- マルチストリーミング対応

#### エッジコンピューティングとの統合
- **エッジブローカー**: デバイス近傍でのメッセージ処理
- **階層型アーキテクチャ**: クラウド-エッジ-デバイス間の最適化
- **オフライン機能**: 接続断絶時のローカルバッファリング

## 1.5 他のプロトコルとの比較

### HTTP vs MQTT

| 特徴 | HTTP | MQTT |
|------|------|------|
| 通信モデル | リクエスト-レスポンス | Publish-Subscribe |
| オーバーヘッド | 高い | 低い |
| リアルタイム性 | ポーリングが必要 | プッシュベース |
| 電池寿命 | 短い | 長い |
| ファイアウォール | 通過しやすい | 設定が必要 |

### CoAP vs MQTT

| 特徴 | CoAP | MQTT |
|------|------|------|
| トランスポート | UDP | TCP |
| 信頼性 | アプリケーション層で実装 | トランスポート層で保証 |
| セキュリティ | DTLS | TLS |
| 用途 | リソースアクセス | メッセージング |

### WebSocket vs MQTT

| 特徴 | WebSocket | MQTT |
|------|-----------|------|
| 目的 | リアルタイム双方向通信 | IoTメッセージング |
| プロトコル層 | アプリケーション層 | アプリケーション層（MQTT over WebSocket可能）|
| QoS | なし | 3レベル |
| セッション管理 | 基本的 | 高度 |

## 1.6 学習の進め方

このドキュメントシリーズでは、以下の順序で学習することを推奨します：

1. **基礎理解** (本章): MQTTの全体像を把握
2. **概念学習** (次章): Pub/Sub、QoS、セッション等の基本概念
3. **プロトコル詳細**: パケット構造と通信フロー
4. **実装実践**: ブローカー選択とクライアント開発
5. **セキュリティ**: 認証、暗号化、アクセス制御
6. **発展機能**: MQTT 5.0、クラウド統合、ファイル転送

## 参考リンク

- [MQTT Version 5.0 OASIS Standard](https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html)
- [Eclipse Mosquitto - 軽量MQTTブローカー](https://mosquitto.org/)
- [EMQX - エンタープライズMQTTプラットフォーム](https://www.emqx.com/)
- [AWS IoT Core - マネージドMQTTサービス](https://aws.amazon.com/iot-core/)
- [HiveMQ MQTT Essentials - 学習リソース](https://www.hivemq.com/mqtt-essentials/)

---

**次の章**: [02-concepts.md](02-concepts.md) - MQTTの基本概念とアーキテクチャ